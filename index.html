<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Nutrition Coach</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script>
        function showLoading() { document.getElementById("loading-message").style.display = "block"; }
        function clearImage() {
            document.getElementById("uploaded-image").innerHTML = "";
            document.getElementById("file").value = "";
        }
    </script>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>AI Nutrition Coach</h1>
    </div>
    <form method="POST" enctype="multipart/form-data" class="form" onsubmit="showLoading()">
        <div class="input-group">
            <label for="user_query">Ask a question about the uploaded image:</label>
            <input type="text" name="user_query" id="user_query" value="{{ user_query }}">
        </div>
        <div class="input-group">
            <label for="file">Choose an image:</label>
            <input type="file" name="file" id="file" accept="image/*" required>
            <button type="button" class="btn-primary" onclick="clearImage()">âœ– Remove Image</button>
        </div>
        <div class="input-group">
            <button type="submit" name="action" value="ask_anything" class="btn-primary">Ask Anything</button>
            <button type="submit" name="action" value="total_calories" class="btn-primary">Total Calories</button>
        </div>
    </form>

    <div id="loading-message" style="display:none;" class="loading">
        <p>Calculating, please wait...</p>
    </div>

    <div id="uploaded-image" style="margin-top:20px; text-align:center;">
        {% if uploaded_image %}
            <img src="data:image/jpeg;base64,{{ uploaded_image }}" class="uploaded-image-preview">
        {% endif %}
    </div>

    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        <ul class="flashes">
            {% for category, message in messages %}
                <li class="{{ category }}">{{ message }}</li>
            {% endfor %}
        </ul>
    {% endif %}
    {% endwith %}

    {% if response_ask %}
        <div class="result">
            <h2>Answer to your question:</h2>
            <div class="response-content">{{ response_ask|safe }}</div>
        </div>
    {% endif %}

    {% if response_cal %}
        <div class="result">
            <h2>Total Calories & Nutrients:</h2>
            <div class="response-content">{{ response_cal|safe }}</div>
        </div>
    {% endif %}
</div>
</body>
</html>
